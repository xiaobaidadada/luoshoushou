# 前提

本文对单体应用到分布式应用，是怎么一步一步转变的，转变的过程中出现的哪些问题，做一次讨论；然后给出每一个步骤有什么工具可以利用，有什么问题需要解决，有什么框架出现了；

# 把一个单体的逻辑分开

把一个项目分成多个小项目，部署到不同的机器上，这是分布式要面对的第一个问题，分布式，当然要分开啊；

1. 问题是分开后，怎么互相调用；
2. 我们可以采用rpc的方式，这是一种使用tcp协议实现的调用方式，或者使用http；其中可以利用一些算法，进行更多功能的通信，如使用队列的消息通信；
3. 对于使用rpc的方式，现成的框架有bubbo，grpc等
4. 对于使用http的解决方式，需要先把服务组成多个web服务器，然后对接口使用 feign框架进行使用（要搭配一个注册中心）
5. 消息队列是缓冲请求调用，有rabbitMQ,rocketMqd等框架



# 多个节点的统一调控

1. 前面把一个单体应用分解成了多个小项目，分布部署在多个不同的主机上，我们把这些成为**节点**；问题来了，这些节点之间的配置能不能统一呢，不然每次配置一些设置需要分别打开每个项目的配置文件，重启一下，这就太低效率了，还有，这些分布式的接口不管是rpc还是http的，一个接口可能为了流量压力提供了多个副本节点，他们的功能一样，怎么能统一管理这些相同功能的节点呢。

2. 这个问题的解决办法就是提供分布式管理中心服务器，管理中心提供两个功能，配置管理和服务管理，配置管理就是统一管理配置中心的一个配置，所有的服务器节点都可以获取到相同的配置，服务管理（服务注册）是对多个相同功能的节点提供的服务进行一个集合统一，多个节点调用的时候可以根据服务名字查询到有几个具体的实例节点；
3. 管理中心服务器有eureka,nacos等，这些配置和服务接口，都只是字符串，要想真正的利用，还得需要rpc框架或者feign进行整合，对于配置管理，spring cloud提供了自动配置springboot的功能；



# 负载均衡

1. 对于前面的的分布式管理中心服务器，一个服务器上的服务可能有好几个服务，我们怎么均衡的调用这些服务呢，这就需要一个负载均衡算法了（可以看我的其他文章），已经有一些成熟的框架了，比如ribbon，对于rpc，feign等框架，他们都内置了一些负载均衡的办法，可以处理；
2. 对于负载均衡，我们一般不会自己去设计算法，这是一个在很多阶段都可能出现的问题，还可以使用nginx对流量的初始阶段进行负载均衡；



# 熔断限流

1. 熔断限流是一个新的问题，当多个节点因为流量突然激增，这要怎么解决呢，突然的激增可能导致服务器崩溃
2. 我们可以 前面的分布式节点的消息通信方式，来缓冲流量达到目的，也可以使用拒绝请求策略，使用流量控制的办法来进行，对于流量突然的激增，可以使用流量控制在一定范围内，对过度的流量进行堵截拒绝，达到目的；
3. 对于一些节点的崩溃，可以提供熔断服务，直接拒接请求，避免一个接一个的节点的等待，消耗资源；
4. 熔断和限流可以使用sentinel框架，这是一个集成在spring cloud ablibaba中的



# 分布式并发的考虑

1. 这个问题是，多个节点操作同一个资源（如数据库），怎么处理并发问题；还有这个部分要知道CAP理论，CAP理论可以看我的其它文章；
2. 如果是数据库，我们可以使用分布式事务，就是说有一个主节点，多个从节点，当全部节点完成之后，系统会自动判断全部的节点的单个事务有没有完成，如果没有完成所有节点的事务都要撤回；我们可以使用，seata框架来很方便的实现这个功能
3. 如果是其它类型的资源呢，这个时候就要利用信号量的机制，手动处理了，可以利用zookeeper，也可以利用redis，这就是分布式锁



# 节点的网关功能

其实不仅仅分布式有这个问题需求 ，就算是单体应用，也需要这个功能，比如我们会使用apache或者nginx来进行代理转发，负载均衡，路由等功能，就是提供一个节点，然后对请求内容进行统一配置分发；在分布式结构中，每一个节点都需要考虑这个问题(不过对于不太复杂的应用，这个问题不是必须的)

1. 这个问题自己手动是无法解决的，因为像负载均衡，路由转发，代理等，都需要大量分任务代码，我们只需要使用框架就行了，spring cloud alibaba中的组件gateway就是一个实现；



到这里文章就结束了，分布式所面对的问题，已经目前的解决框架主要的就这么多；