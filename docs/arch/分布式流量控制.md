# 什么是分布式的流量控制

在分布式应用环境下，数据在各个节点之间的传输就是流量，对于秒杀这种服务，突然请求非常多，服务器在面对这种情况的时候怎么办呢，服务器默认是没有应对办法的，他会不断的创建线程，这样最终可能造成机器死机；

我们可以采用流量控制的策略，设置服务器处理请求的时间，多少时间处理多少个请求，如果过量直接拒绝，避免死机；还有流量的频繁访问等问题，这些都是需要考虑的，就算没有分布式架构也要考虑，只是在分布式架构下，有它特定的处理方式，和处理框架；其中两个核心的问题是服务限流和熔断服务

# 什么是服务限流

就是前面说的请求量过大会造成的局面，所以我们要限流，让请求过多的时候直接返回拒绝；这样虽然客户端部分用户无法正常使用，但总比直接死机强

拒绝的算法有大概这几种；

1. 计数器算法

   简单，可用于短信触发等，设置时间间隔，比如一秒内只能处理100个请求；

   这样会有一个问题，在上一秒刚结束，和下一秒刚开始的时候，都发生了一百次请求，服务器的一秒间隔有自己的设置，但是客服的一秒是什么时候开始，和服务器是不同步的，在客户看起来，就好像一秒内可以请求二百次；

   解决这个问题，可以在后端设置时间间隔的开始时间；或者用下面的办法；

2. 滑动窗口算法

   将时间大的时间间隔再细分一下，设置窗口大小为原来的时间间隔，窗口不断的滑动，这样就可以统计刚刚的时间间隔内发生的次数，而不会出现每个间隔都是隔离的局面；

   

   每一次都是一个区间，而不是在特定的一秒或者一个时间内，区间的大小是固定的，所以每次都需要统计这个区间内的所有数量；

3. 令牌捅

   服务端设置一个捅，以恒定的速度往捅理放令牌，请求需要得到令牌才可以正常进行，如果没有请求就触发了限流，桶内的数量够多的话可以对应突击的流量；

4. 漏桶限流算法

   请求不断的被装入服务器的通内，服务端以恒定的速度去处理请求，如果捅满了会触发限流；

# 熔断降级

`熔断`和`降级`这两个词是对同一个概念的不同解释，如果一个分布式节点发生了请求量过大，或者它的某些支持不能进行了，请求这个节点的其它节点，会一直等待，其它节点可能会发生链式的传递等待，最终造成大面积的节点发生请求 积攒最终瘫痪；熔断降级是对于一个节点来说，如果它 不能完成某个任务，他就要根据一些策略（哪些不能完成的任务）直接返回报错，而不会一直等待，直到这个请求能正常的进行他才会运行请求；熔断降级的意思就像`优秀`这个词一样，优和秀就算分开也可以表达同一个意思；熔断就是请求断开来连接直接返回，降级直接返回了这个服务不是不能进行了，服务的级别就降下去了；

# Sentinel

就是一个流量管理系统，在sprincloud项目中可以很方便的使用，其中有一些核心的观念要理解：

1. 资源：是一个函数，或者一个类中的全部函数，是框架监管的对象，函数的是否正常运行等
2. 规则管理：需要用调用库的特定函数来指定管理策略
3. 有一个可视化的控制台可以使用，因为有了这个springboot没有提供过多的yml配置选项
4. 可以集成nacos同步策略配置信息

